function e(e){return e&&e.__esModule?e.default:e}var t,s,i,a,r,o=globalThis,h={},n={},p=o.parcelRequired258;null==p&&((p=function(e){if(e in h)return h[e].exports;if(e in n){var t=n[e];delete n[e];var s={id:e,exports:{}};return h[e]=s,t.call(s.exports,s,s.exports),s.exports}var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}).register=function(e,t){n[e]=t},o.parcelRequired258=p),(0,p.register)("dRo73",function(e,t){Object.defineProperty(e.exports,"register",{get:()=>s,set:e=>s=e,enumerable:!0,configurable:!0});var s,i=new Map;s=function(e,t){for(var s=0;s<t.length-1;s+=2)i.set(t[s],{baseUrl:e,path:t[s+1]})}}),p("dRo73").register(new URL("",import.meta.url).toString(),JSON.parse('["50T4R","index.1151d3b1.js","izIfw","stockholm_map.2976de6e.png","8iljz","zombie_spritesheet.cc0599cc.png","4SA1F","mami_spritesheet.b49e3f9a.png","bQWk6","papi_spritesheet.5fe8d860.png","fyi2M","ahlens_map.e96a496f.png","l8cJ8","player.8afcec90.png","9iMz8","sheath_upper_body_spritesheet-Sheet.00c176c4.png","ic9tz","sprint_sheathed_upper_body_sprites-Sheet.d8fcc020.png","iBEtK","walking_equipped_upper_body_sprites-Sheet.6002e4f2.png","dVSfy","stale_sheathed_upper_body.c56cbeba.png","lUSVs","stale_equipped_upper_body.243306a2.png","7uTuz","walking_equipped_legs_sprites-Sheet.d820a7b4.png","dQRQ3","stale_legs.6bff9712.png","3sx9y","sprint_sheathed_legs_sprites-Sheet.07759801.png","68iBc","jump_equipped_upper_body_sprites-Sheet.02eed12b.png","82s9c","jump_legs_sprites-Sheet.b5417699.png","Xjeq3","jump_legs_stale_upward.b3268ac4.png","b7vD3","jump_equipped_upper_body_stale_upward.8a9322b7.png"]'));var l={};l=new URL("stockholm_map.2976de6e.png",import.meta.url).toString();const c=(e,t)=>{let s=Math.ceil(e);return Math.floor(Math.random()*(Math.floor(t)-s+1)+s)};s=class{position;size;rotation;constructor(e,t,s=0){this.position=e,this.size=t,this.rotation=s}distanceTo(e){return Math.sqrt(Math.pow(this.position.x-e.x,2)+Math.pow(this.position.y-e.y,2))}draw(e,t){throw Error("#draw not implemented yet!")}};const m={archeologist:{type:"archeologist",skills:[{name:"Hit",validTarget:["enemy"],numberOfTargets:1,generateSkillEffect:({multiplier:e=0,fixedBonus:t=0})=>({type:"damage",points:10*e+t}),unlockLvl:1},{name:"Throw Dirt",validTarget:["enemy"],numberOfTargets:1,generateSkillEffect:()=>({type:"blind",duration:2}),unlockLvl:1},{name:"Examine",validTarget:["enemy"],numberOfTargets:-1,generateSkillEffect:()=>({type:"weaken",duration:1}),unlockLvl:2},{name:"Dig",validTarget:["allies"],numberOfTargets:1,generateSkillEffect:()=>({type:"evade",duration:2}),unlockLvl:3}]},medic:{type:"medic",skills:[{name:"Stitch",validTarget:["allies","self"],numberOfTargets:1,generateSkillEffect:()=>({type:"heal",points:15}),unlockLvl:1},{name:"Cut",validTarget:["enemy"],numberOfTargets:1,generateSkillEffect:({multiplier:e=0,fixedBonus:t=0})=>({type:"damage",points:15*e+t}),unlockLvl:1},{name:"Drain Blood",validTarget:["enemy"],numberOfTargets:1,generateSkillEffect:()=>({type:"bleed",points:10,duration:3}),unlockLvl:2},{name:"Restrain",validTarget:["enemy"],numberOfTargets:1,generateSkillEffect:()=>({type:"snare",duration:1}),unlockLvl:3},{name:"Drug",validTarget:["enemy"],numberOfTargets:2,generateSkillEffect:()=>({type:"confuse",duration:1}),unlockLvl:4}]},zombie:{type:"zombie",skills:[{name:"Scratch",validTarget:["enemy"],numberOfTargets:1,generateSkillEffect:({multiplier:e=0,fixedBonus:t=0})=>({type:"damage",points:15*e+t}),unlockLvl:1}]}};var d={};d=new URL("zombie_spritesheet.cc0599cc.png",import.meta.url).toString();class g extends s{lvl;size={height:100,width:100};name="Zombie";role=m.zombie;hp;stats;effects=[];spritesheet=new Image;constructor(t,s,i=0,a={height:50,width:50}){super(s,a,i),this.lvl=t,this.spritesheet.src=e(d);let r=this.generateStatsFromLvl(t);this.hp=r.maxHp,this.stats=r}generateStatsFromLvl(e){return{maxHp:40*e,maxStamina:40*e,strength:1*e,intelligence:1*e,hitRate:1-.4*e,dodgeChance:1-.9*e}}draw({ctx:e,offsetX:t=0,offsetY:s=0},i=!1){if(e.save(),e.translate(t,s),e.imageSmoothingEnabled=!1,i){e.shadowColor="yellow",e.shadowBlur=0;let t=[-2,2];for(let s=0;s<t.length;s++){e.shadowOffsetX=t[s];for(let s=0;s<t.length;s++)e.shadowOffsetY=t[s],e.drawImage(this.spritesheet,this.position.x-this.size.width/2,this.position.y-this.size.height,this.size.width,this.size.height)}}e.drawImage(this.spritesheet,this.position.x-this.size.width/2,this.position.y-this.size.height,this.size.width,this.size.height),e.resetTransform(),e.restore()}}var u={};u=new URL("mami_spritesheet.b49e3f9a.png",import.meta.url).toString();class f extends s{lvl;stats;name="Mami";role=m.medic;hp;effects=[];spritesheet=new Image;constructor(t,s,i,a=0,r={height:96,width:96}){super(i,r,a),this.lvl=t,this.stats=s,this.spritesheet.src=e(u),this.hp=s.maxHp}draw({ctx:e,offsetX:t=0,offsetY:s=0},i=!1){if(e.save(),e.translate(t,s),e.imageSmoothingEnabled=!1,i){e.shadowColor="yellow",e.shadowBlur=0;let t=[-2,2];for(let s=0;s<t.length;s++){e.shadowOffsetX=t[s];for(let s=0;s<t.length;s++)e.shadowOffsetY=t[s],e.drawImage(this.spritesheet,this.position.x-this.size.width/2,this.position.y-this.size.height,this.size.width,this.size.height)}}e.drawImage(this.spritesheet,this.position.x-this.size.width/2,this.position.y-this.size.height,this.size.width,this.size.height),e.resetTransform(),e.restore()}}var S={};S=new URL("papi_spritesheet.5fe8d860.png",import.meta.url).toString();class y extends s{lvl;stats;name="Papi";role=m.archeologist;hp;effects=[];spritesheet=new Image;constructor(t,s,i,a=0,r={height:96,width:96}){super(i,r,a),this.lvl=t,this.stats=s,this.spritesheet.src=e(S),this.hp=s.maxHp}draw({ctx:e,offsetX:t=0,offsetY:s=0},i=!1){if(e.save(),e.translate(t,s),e.imageSmoothingEnabled=!1,i){e.shadowColor="yellow",e.shadowBlur=0;let t=[-2,2];for(let s=0;s<t.length;s++){e.shadowOffsetX=t[s];for(let s=0;s<t.length;s++)e.shadowOffsetY=t[s],e.drawImage(this.spritesheet,this.position.x-this.size.width/2,this.position.y-this.size.height,this.size.width,this.size.height)}}e.drawImage(this.spritesheet,this.position.x-this.size.width/2,this.position.y-this.size.height,this.size.width,this.size.height),e.resetTransform(),e.restore()}}class w{background;foes;players;constructor(e,t,s){this.background=s,this.foes=this.generateFoes(e,t.foes),this.players=this.generatePlayers(e,t.players)}generateFoes(e,t){let s=c(t.min,t.max),i=[];for(let e=0;e<s;e++){let e=Math.floor(Math.random()*t.types.length),s=t.types[e];if(!s)continue;let a=c(s.lvl.min,s.lvl.max);i.push({type:s.type,lvl:a})}let a=e.gameHeight/3,r=i.length%3==0?3:i.length%3;return i.map((e,t)=>{let s=Math.floor(t/3)+1,o=Math.ceil(i.length/3)===s?r:3,h=a/o;switch(e.type){case"zombie":case"brute":return new g(e.lvl,{x:40+70*s-t%3*(60/o),y:t%3*h+h/2+2*a})}})}generatePlayers(e,t){let s=e.gameHeight/3,i=t.length%3==0?3:t.length%3;return t.map((a,r)=>{let o=Math.floor(r/3)+1,h=Math.ceil(t.length/3)===o?i:3,n=s/h,p=r%3*n+n/2+2*s,l=e.gameWidth-70*o-r%3*(60/h);switch(a.name){case"mami":return new f(a.lvl,a.stats,{x:l,y:p});case"papi":return new y(a.lvl,a.stats,{x:l,y:p})}})}drawBackground({game:e,ctx:t,offsetX:s=0,offsetY:i=0}){let a=Math.min(e.gameWidth/this.background.width,e.gameHeight/this.background.height),r=(e.gameWidth-this.background.width*a)/2,o=(e.gameHeight-this.background.height*a)/2;t.translate(s,i),t.drawImage(this.background,0,0,this.background.width,this.background.height,r,o,this.background.width*a,this.background.height*a),t.resetTransform()}}var b={};b=new URL("ahlens_map.e96a496f.png",import.meta.url).toString();class _ extends w{constructor(t,s){let i=new Image;i.src=e(b),super(t,{players:s,foes:{min:3,max:4,types:[{type:"zombie",lvl:{min:1,max:2}},{type:"brute",lvl:{min:1,max:2}}]}},i)}}(t=i||(i={}))[t.BATTLE=0]="BATTLE";class k{texture;stops=[{type:i.BATTLE,setupBattle:e=>new _(e.game,e.players),x:577,y:206},{type:i.BATTLE,setupBattle:e=>new _(e.game,e.players),x:548,y:252},{type:i.BATTLE,setupBattle:e=>new _(e.game,e.players),x:467,y:310},{type:i.BATTLE,setupBattle:e=>new _(e.game,e.players),x:493,y:376},{type:i.BATTLE,setupBattle:e=>new _(e.game,e.players),x:335,y:384},{type:i.BATTLE,setupBattle:e=>new _(e.game,e.players),x:362,y:460},{type:i.BATTLE,setupBattle:e=>new _(e.game,e.players),x:430,y:452}];currentStop=this.stops[0];player={originPos:{x:this.stops[0].x,y:this.stops[0].y},queue:[]};constructor(){let t=new Image;t.src=e(l),this.texture=t}}var x={};x=new URL("player.8afcec90.png",import.meta.url).toString(),a=class{constructor(){}};class v extends a{x;y;constructor(e,t){super(),this.x=e,this.y=t}magnitude(){return Math.sqrt(Math.pow(this.x,2)+Math.pow(this.y,2))}dot(e){return this.x*e.x+this.y*e.y}norm(){return{x:this.x/this.magnitude(),y:this.y/this.magnitude()}}normalize(){let e=this.norm();return new v(e.x,e.y)}}const E=["up","left","down","right","esc","enter"];class T{game;map=new k;playerTexture;constructor(t){this.game=t;let s=new Image;s.src=e(x),this.playerTexture=s}update(e){if(E.some(e=>this.game.input.has(e))&&this.game.input.forEach(e=>{let t=this.map.stops.indexOf(this.map.currentStop),s=this.map.stops.length-1===t?null:{stop:this.map.stops[t+1],vectorTo:new v(this.map.stops[t+1].x-this.map.currentStop.x,this.map.stops[t+1].y-this.map.currentStop.y)},i=0===t?null:{stop:this.map.stops[t-1],vectorTo:new v(this.map.stops[t-1].x-this.map.currentStop.x,this.map.stops[t-1].y-this.map.currentStop.y)};switch(e){case"up":(s&&s.vectorTo.y<0||i&&i.vectorTo.y<0)&&(s&&i?s.vectorTo.norm().y<i.vectorTo.norm().y?this.map.currentStop=s.stop:this.map.currentStop=i.stop:s?this.map.currentStop=s.stop:i&&(this.map.currentStop=i.stop));break;case"down":(s&&s.vectorTo.y>0||i&&i.vectorTo.y>0)&&(s&&i?s.vectorTo.norm().y>i.vectorTo.norm().y?this.map.currentStop=s.stop:this.map.currentStop=i.stop:s?this.map.currentStop=s.stop:i&&(this.map.currentStop=i.stop));break;case"left":(s&&s.vectorTo.x<0||i&&i.vectorTo.x<0)&&(s&&i?s.vectorTo.norm().x<i.vectorTo.norm().x?this.map.currentStop=s.stop:this.map.currentStop=i.stop:s?this.map.currentStop=s.stop:i&&(this.map.currentStop=i.stop));break;case"right":(s&&s.vectorTo.x>0||i&&i.vectorTo.x>0)&&(s&&i?s.vectorTo.norm().x>i.vectorTo.norm().x?this.map.currentStop=s.stop:this.map.currentStop=i.stop:s?this.map.currentStop=s.stop:i&&(this.map.currentStop=i.stop));break;case"esc":this.game.state="PAUSE_SCREEN",this.game.pauseScreen.show();break;case"enter":{let e=this.map.currentStop.setupBattle({game:this.game,players:this.game.players});this.game.battleSystem.battle.active=e,this.game.state="BATTLE_SCENE"}}let a=this.map.player.queue.indexOf(this.map.currentStop);a>=0?this.map.player.queue=this.map.player.queue.slice(0,a+1):(this.map.currentStop.x!==this.map.player.originPos.x||this.map.currentStop.y!==this.map.player.originPos.y)&&this.map.player.queue.push(this.map.currentStop)}),0!==this.map.player.queue.length){let t=new v(this.map.player.queue[0].x-this.map.player.originPos.x,this.map.player.queue[0].y-this.map.player.originPos.y),s=t.norm(),i=new v(170*s.x*e,170*s.y*e);i.magnitude()>t.magnitude()?(this.map.player.originPos.x=this.map.player.queue[0].x,this.map.player.originPos.y=this.map.player.queue[0].y,this.map.player.queue.shift()):(this.map.player.originPos.x+=i.x,this.map.player.originPos.y+=i.y)}}draw(e){let t=Math.min(this.game.gameWidth/this.map.texture.width,this.game.gameHeight/this.map.texture.height),s=(this.game.gameWidth-this.map.texture.width*t)/2,i=(this.game.gameHeight-this.map.texture.height*t)/2;e.clearRect(0,0,this.game.gameWidth,this.game.gameHeight),e.drawImage(this.map.texture,0,0,this.map.texture.width,this.map.texture.height,s,i,this.map.texture.width*t,this.map.texture.height*t);for(let t=0;t<this.map.stops.length;t++)this.map.stops[t+1]&&(e.save(),e.beginPath(),e.setLineDash([5,3]),e.moveTo(this.map.stops[t].x+s,this.map.stops[t].y+i),e.lineTo(this.map.stops[t+1].x+s,this.map.stops[t+1].y+i),e.lineWidth=3,e.stroke(),e.restore()),e.save(),e.fillStyle=this.map.currentStop===this.map.stops[t]?"red":"orange",e.beginPath(),e.arc(this.map.stops[t].x+s,this.map.stops[t].y+i,5,0,2*Math.PI),e.fill(),e.restore();e.drawImage(this.playerTexture,this.map.player.originPos.x+s-17.5,this.map.player.originPos.y+i-40,35,35)}}const H=e=>{let t=document.getElementById(e);if(null===t)throw Error(`Could not find element with id ${e}`);return t},M=H("pauseScreen"),R=H("options"),L=["up","left","down","right","enter","esc"];class A{game;options=[{id:"continue",text:"Continue"},{id:"map",text:"Map"},{id:"settings",text:"Settings"},{id:"credits",text:"Credits"}];selectedOption="continue";constructor(e){this.game=e;let t=H("options");for(let e of this.options){let s=document.createElement("span");e.id===this.selectedOption&&s.setAttribute("data-selected","selected"),s.setAttribute("data-optionId",e.id),s.textContent=e.text,s.addEventListener("mouseenter",()=>{this.handleSwitchSelectedOption(()=>e)}),s.addEventListener("click",()=>{this.handleSubmitOption()}),t.appendChild(s)}}show(){M.style.display="flex"}hide(){M.style.display="none"}handleSwitchSelectedOption(e){let t=R.querySelector("[data-selected='selected']");if(t){t.removeAttribute("data-selected");let s=t.getAttribute("data-optionId"),i=this.options.findIndex(e=>e.id===s),a=e(-1===i?null:i),r=R.querySelector(`[data-optionId='${a.id}']`);r&&(this.selectedOption=a.id,r.setAttribute("data-selected","selected"))}}handleSubmitOption(){switch(this.selectedOption){case"continue":this.hide(),this.game.state="RUNNING";break;case"map":this.hide(),this.game.state="MAP_SCREEN"}}update(){L.some(e=>this.game.input.has(e))&&this.game.input.forEach(e=>{switch(e){case"up":this.handleSwitchSelectedOption(e=>0===e||null===e?this.options[this.options.length-1]:this.options[e-1]);break;case"down":this.handleSwitchSelectedOption(e=>e===this.options.length-1||null===e?this.options[0]:this.options[e+1]);break;case"esc":this.hide(),this.game.state="RUNNING";break;case"enter":this.handleSubmitOption()}})}}const I=["up","left","down","right","esc","enter"];class B{game;battle={active:null,queue:[]};state={name:"SLEEP"};animations=[{type:"commence-battle",durationMs:1200,timePassedMs:0}];constructor(e){this.game=e}update(e){if(this.battle.active&&(this.updateAnimations(e).deleted.some(e=>"commence-battle"===e.type)&&(this.state=this.calculateNextState(this.battle.active)),I.some(e=>this.game.input.has(e))))for(let e of this.game.input)switch(this.state.name){case"SLEEP":case"ENEMY_TURN":break;case"PLAYER_SELECT_SKILL":switch(e){case"up":{let e=this.mapToSkillSet(this.state.characterTurn.role.skills),t=this.state.focusedSkill,s=e.find(e=>e.some(e=>e===t));if(!s)throw Error("#columnWithFocusedSkill is undefined");let i=s.indexOf(t),a=s.at(i-1);a&&(this.state.focusedSkill=a);break}case"down":{let e=this.mapToSkillSet(this.state.characterTurn.role.skills),t=this.state.focusedSkill,s=e.find(e=>e.some(e=>e===t));if(!s)throw Error("#columnWithFocusedSkill is undefined");let i=s.indexOf(t),a=s.at(i-2+1);a&&(this.state.focusedSkill=a);break}case"left":{let e=this.mapToSkillSet(this.state.characterTurn.role.skills),t=this.state.focusedSkill,s=e.find(e=>e.some(e=>e===t));if(!s)throw Error("#columnWithFocusedSkill is undefined");let i=e.findIndex(e=>e.some(e=>e===t)),a=s.indexOf(t),r=e.at(i-1)?.at(a);r&&(this.state.focusedSkill=r);break}case"right":{let e=this.mapToSkillSet(this.state.characterTurn.role.skills),t=this.state.focusedSkill,s=e.find(e=>e.some(e=>e===t));if(!s)throw Error("#columnWithFocusedSkill is undefined");let i=e.findIndex(e=>e.some(e=>e===t)),a=s.indexOf(t),r=e.at(i-e.length)?.at(a);r&&(this.state.focusedSkill=r);break}case"esc":this.game.state="PAUSE_SCREEN",this.game.pauseScreen.show();break;case"enter":this.state={name:"PLAYER_SELECT_TARGET",characterTurn:this.state.characterTurn,selectedSkill:this.state.focusedSkill,selectedTargets:[],focusedTarget:this.battle.active.foes[0]}}break;case"PLAYER_SELECT_TARGET":{let t=[...this.battle.active.players,...this.battle.active.foes],s=t.indexOf(this.state.focusedTarget),[i]=t.splice(s,1);if(!i)throw Error("#currentlySelectedTarget is undefined!");let a=t.map(e=>({target:e,vectorTo:new v(e.position.x-i.position.x,e.position.y-i.position.y)}));switch(e){case"up":{let e=a.filter(e=>{let t=e.vectorTo.norm();return Math.abs(t.y)>Math.abs(t.x)}).filter(e=>e.vectorTo.y<0);if(0===e.length)break;let[t]=e.sort((e,t)=>e.vectorTo.magnitude()-t.vectorTo.magnitude());this.state.focusedTarget=t.target;break}case"down":{let e=a.filter(e=>{let t=e.vectorTo.norm();return Math.abs(t.y)>Math.abs(t.x)}).filter(e=>e.vectorTo.y>0);if(0===e.length)break;let[t]=e.sort((e,t)=>e.vectorTo.magnitude()-t.vectorTo.magnitude());this.state.focusedTarget=t.target;break}case"left":{let e=a.filter(e=>{let t=e.vectorTo.norm();return Math.abs(t.x)>Math.abs(t.y)}).filter(e=>e.vectorTo.x<0);if(0===e.length)break;let[t]=e.sort((e,t)=>e.vectorTo.magnitude()-t.vectorTo.magnitude());this.state.focusedTarget=t.target;break}case"right":{let e=a.filter(e=>{let t=e.vectorTo.norm();return Math.abs(t.x)>Math.abs(t.y)}).filter(e=>e.vectorTo.x>0);if(0===e.length)break;let[t]=e.sort((e,t)=>e.vectorTo.magnitude()-t.vectorTo.magnitude());this.state.focusedTarget=t.target;break}case"enter":this.state.selectedTargets.push(this.state.focusedTarget),this.state.selectedTargets.length>=2&&this.executeAction(this.state);break;case"esc":this.game.state="PAUSE_SCREEN",this.game.pauseScreen.show()}}}}updateAnimations(e){this.animations=this.animations.map(t=>({...t,timePassedMs:t.timePassedMs+1e3*e}));let t=this.animations.reduce((e,t)=>t.timePassedMs>=t.durationMs?{...e,finished:[...e.finished,t]}:{...e,inProgress:[...e.inProgress,t]},{inProgress:[],finished:[]});return this.animations=t.inProgress,{deleted:t.finished}}calculateNextState(e){let t=e.players[0],s=t.role.skills;return{name:"PLAYER_SELECT_SKILL",characterTurn:t,focusedSkill:s[0]}}mapToSkillSet(e){let t=Array(e.length%2==0?e.length:e.length+e.length%2).fill(null);for(let s=0;s<t.length;s++)e[s]&&(t[s]=e[s]);let s=t.length/2,i=[];for(let e=0;e<s;e++)i.push(t.slice(2*e,2));return i}executeAction(e){e.selectedTargets.forEach(t=>{t.effects.push(e.selectedSkill.generateSkillEffect({}))})}draw(e){if(this.battle.active){if(e.clearRect(0,0,this.game.gameWidth,this.game.gameHeight),!this.animations.some(e=>"commence-battle"===e.type))for(let t of(e.imageSmoothingEnabled=!1,this.battle.active.drawBackground({ctx:e,game:this.game}),[...this.battle.active.foes,...this.battle.active.players])){let s="PLAYER_SELECT_TARGET"===this.state.name&&this.state.focusedTarget===t;t.draw({ctx:e},s)}for(let t of this.animations){let s=Math.min(t.timePassedMs/t.durationMs,1);if("commence-battle"===t.type){let t=this.game.gameWidth*s-this.game.gameWidth;e.imageSmoothingEnabled=!1,this.battle.active.drawBackground({ctx:e,game:this.game,offsetX:-t,offsetY:0});let i=this.game.gameWidth-this.game.gameWidth*s;for(let t of[...this.battle.active.foes,...this.battle.active.players])t.draw({ctx:e,offsetX:-i,offsetY:0})}}if("PLAYER_SELECT_SKILL"===this.state.name){let t=this.mapToSkillSet(this.state.characterTurn.role.skills);for(let s=0;s<t.length;s++)for(let i=0;i<2;i++){let a=this.game.gameWidth/t.length;e.save(),e.fillStyle="lightgray",e.lineWidth=5,e.strokeStyle="black",e.fillRect(a*s,50*i,a,50),e.strokeRect(a*s+2.5,50*i+2.5,a-5,45),e.restore();let r=t[s][i];r&&(e.save(),e.font="30px serif",e.textAlign="center",e.fillStyle="black",e.fillText(r.name,a*s+a/2,50*i+40),e.restore())}for(let s=0;s<t.length;s++)for(let i=0;i<2;i++){let a=this.game.gameWidth/t.length;e.save(),e.lineWidth=5,e.strokeStyle="red",t[s][i]===this.state.focusedSkill&&e.strokeRect(a*s+2.5,50*i+2.5,a-5,45),e.restore()}}}}}var F={};F=new URL("sheath_upper_body_spritesheet-Sheet.00c176c4.png",import.meta.url).toString();var j={};j=new URL("sprint_sheathed_upper_body_sprites-Sheet.d8fcc020.png",import.meta.url).toString();var q={};q=new URL("sprint_sheathed_legs_sprites-Sheet.07759801.png",import.meta.url).toString();var O={};O=new URL("walking_equipped_upper_body_sprites-Sheet.6002e4f2.png",import.meta.url).toString();var P={};P=new URL("stale_sheathed_upper_body.c56cbeba.png",import.meta.url).toString();var z={};z=new URL("stale_equipped_upper_body.243306a2.png",import.meta.url).toString();var U={};U=new URL("walking_equipped_legs_sprites-Sheet.d820a7b4.png",import.meta.url).toString();var C={};C=new URL("jump_equipped_upper_body_sprites-Sheet.02eed12b.png",import.meta.url).toString();var W={};W=new URL("jump_legs_sprites-Sheet.b5417699.png",import.meta.url).toString();var N={};N=new URL("jump_legs_stale_upward.b3268ac4.png",import.meta.url).toString();var Y={};Y=new URL("jump_equipped_upper_body_stale_upward.8a9322b7.png",import.meta.url).toString();var D={};D=new URL("stale_legs.6bff9712.png",import.meta.url).toString();class X extends s{vector=new v(0,0);direction="right";isSheathed=!1;isJumping=!1;action={duck:{state:"not-in-use",progressMs:0},walk:{state:"not-in-use",progressMs:0},fall:{state:"not-in-use",progressMs:0},sheath:{state:"not-in-use",progressMs:0},jump:{state:"not-in-use",progressMs:0}};sheathBodySheet=new Image;walkingBodySheet=new Image;sprintSheathedBodySheet=new Image;sprintSheathedLegsSheet=new Image;staleSheathedBodySprite=new Image;staleEquippedBodySprite=new Image;jumpEquippedBodySheet=new Image;jumpLegsSheet=new Image;jumpLegsStaleUpwardSprite=new Image;jumpEquippedBodyStaleUpwardSprite=new Image;walkingLegsSheet=new Image;staleLegsSprite=new Image;constructor(t,s=0,i={height:28,width:20}){super(t,i,s),this.sheathBodySheet.src=e(F),this.walkingBodySheet.src=e(O),this.sprintSheathedBodySheet.src=e(j),this.sprintSheathedLegsSheet.src=e(q),this.staleSheathedBodySprite.src=e(P),this.staleEquippedBodySprite.src=e(z),this.jumpEquippedBodySheet.src=e(C),this.jumpLegsSheet.src=e(W),this.jumpLegsStaleUpwardSprite.src=e(N),this.jumpEquippedBodyStaleUpwardSprite.src=e(Y),this.walkingLegsSheet.src=e(U),this.staleLegsSprite.src=e(D)}update(e,t){for(let s of(t.some(e=>"duck"===e)||(this.action.duck.progressMs=0,this.action.duck.state="not-in-use"),t.some(e=>"move"===e)||(this.action.walk.state="not-in-use",this.action.walk.progressMs=0),"in-use"===this.action.sheath.state&&(this.action.sheath.progressMs+1e3*e>750?(this.action.sheath.progressMs=0,this.action.sheath.state="not-in-use"):this.action.sheath.progressMs+=1e3*e,t.some(e=>"sheath"===e)&&t.splice(t.indexOf("sheath"),1)),"in-use"===this.action.jump.state&&(this.action.jump.progressMs+1e3*e>500?(this.action.jump.progressMs=0,this.action.jump.state="not-in-use",this.vector.y-=500,this.isJumping=!0):this.action.jump.progressMs+=1e3*e,t.some(e=>"jump"===e)&&t.splice(t.indexOf("jump"),1)),this.action.fall.state="not-in-use",this.action.fall.progressMs=0,t))"move"===s&&(0!==this.vector.x&&(this.vector.x>0?this.direction="right":this.direction="left"),this.action.walk.state="in-use",this.action.walk.progressMs+=1e3*e),"sheath"===s&&(this.isSheathed=!this.isSheathed,this.action.sheath.progressMs+=1e3*e,this.action.sheath.state="in-use"),"duck"===s&&(this.action.duck.progressMs+=1e3*e,this.action.duck.state=this.action.duck.progressMs>=1200?"complete":"in-use"),"jump"===s&&(this.action.jump.progressMs+=1e3*e,this.action.jump.state="in-use");this.position.x+=this.vector.x*e,this.position.y+=this.vector.y*e}draw({ctx:e}){e.save(),e.imageSmoothingEnabled=!1,"right"===this.direction?e.scale(-1,1):e.scale(1,1);let t="right"===this.direction?-1:1;switch(console.log(this.isJumping),!0){case this.isJumping:e.drawImage(this.jumpEquippedBodyStaleUpwardSprite,0,0,20,28,t*this.position.x-50,this.position.y-140,100,140);break;case"in-use"===this.action.jump.state:{let s=this.action.jump.progressMs>500?this.action.jump.progressMs%500/500:this.action.jump.progressMs/500;e.drawImage(this.jumpEquippedBodySheet,20*Math.floor(6*s),0,20,28,t*this.position.x-50,this.position.y-140,100,140);break}case"in-use"===this.action.fall.state:break;case"in-use"===this.action.sheath.state:{let s=this.action.sheath.progressMs>750?this.action.sheath.progressMs%750/750:this.action.sheath.progressMs/750,i=this.isSheathed?Math.floor(15*s):14-Math.floor(15*s);e.drawImage(this.sheathBodySheet,20*i,0,20,28,t*this.position.x-50,this.position.y-140,100,140);break}case"in-use"===this.action.walk.state&&this.isSheathed&&"not-in-use"===this.action.sheath.state:{let s=this.action.walk.progressMs>800?this.action.walk.progressMs%800/800:this.action.walk.progressMs/800;e.drawImage(this.sprintSheathedBodySheet,20*Math.floor(8*s),0,20,28,t*this.position.x-50,this.position.y-140,100,140);break}case"in-use"===this.action.walk.state:{let s=this.action.walk.progressMs>1125?this.action.walk.progressMs%1125/1125:this.action.walk.progressMs/1125;e.drawImage(this.walkingBodySheet,20*Math.floor(9*s),0,20,28,t*this.position.x-50,this.position.y-140,100,140);break}default:e.drawImage(this.isSheathed?this.staleSheathedBodySprite:this.staleEquippedBodySprite,0,0,20,28,t*this.position.x-50,this.position.y-140,100,140)}switch(!0){case this.isJumping:e.drawImage(this.jumpLegsStaleUpwardSprite,0,0,20,28,t*this.position.x-50,this.position.y-140,100,140);break;case"in-use"===this.action.jump.state:{let s=this.action.jump.progressMs>500?this.action.jump.progressMs%500/500:this.action.jump.progressMs/500;e.drawImage(this.jumpLegsSheet,20*Math.floor(6*s),0,20,28,t*this.position.x-50,this.position.y-140,100,140);break}case"in-use"===this.action.fall.state:break;case"in-use"===this.action.walk.state&&this.isSheathed&&"not-in-use"===this.action.sheath.state:{let s=this.action.walk.progressMs>1e3?this.action.walk.progressMs%1e3/1e3:this.action.walk.progressMs/1e3;e.drawImage(this.sprintSheathedLegsSheet,20*Math.floor(10*s),0,20,28,t*this.position.x-50,this.position.y-140,100,140);break}case"in-use"===this.action.walk.state:{let s=this.action.walk.progressMs>1125?this.action.walk.progressMs%1125/1125:this.action.walk.progressMs/1125;e.drawImage(this.walkingLegsSheet,20*Math.floor(10*s),0,20,28,t*this.position.x-50,this.position.y-140,100,140);break}default:e.drawImage(this.staleLegsSprite,0,0,20,28,t*this.position.x-50,this.position.y-140,100,140)}e.restore()}}const J=["left","right","down","up","s"];class G{game;player;constructor(e){this.game=e,this.player=new X({x:e.gameWidth/2,y:e.gameHeight/2},0)}update(e){let t=[];if(this.player.position.y>=this.game.gameHeight/2?(this.player.vector.y=0,this.player.isJumping=!1):this.player.vector.y+=1e3*e,this.game.input.has("left")||this.game.input.has("right")||(this.player.vector.x=0),J.some(e=>this.game.input.has(e)))for(let e of this.game.input)switch(e){case"left":{let e="in-use"!==this.player.action.sheath.state&&this.player.isSheathed?500:150;this.player.vector.x=-e,t.push("move");break}case"right":{let e="in-use"!==this.player.action.sheath.state&&this.player.isSheathed?500:150;this.player.vector.x=e,t.push("move");break}case"down":t.push("duck");break;case"up":t.push("sheath");break;case"s":t.push("jump")}this.player.update(e,t)}draw(e){this.player.draw({ctx:e})}}r=class{gameWidth;gameHeight;mainCtx;mousePos;players=[{name:"mami",lvl:1,stats:{maxHp:60,maxStamina:60,strength:1,intelligence:1,dodgeChance:.1,hitRate:.9}},{name:"papi",lvl:1,stats:{maxHp:60,maxStamina:60,strength:1,intelligence:1,dodgeChance:.1,hitRate:.9}}];mapScreen=new T(this);pauseScreen=new A(this);battleSystem=new B(this);marioSystem;input=new Set;state="RUNNING";constructor(e,t,s,i={x:e/2,y:t/2}){this.gameWidth=e,this.gameHeight=t,this.mainCtx=s,this.mousePos=i;let a=H("gameScreen");this.marioSystem=new G(this),a.addEventListener("click",()=>{this.input.add("leftClick")}),document.addEventListener("keydown",e=>{switch(console.log(e.key),e.key){case"Escape":this.input.add("esc");break;case"ArrowUp":this.input.add("up");break;case"ArrowLeft":this.input.add("left");break;case"ArrowDown":this.input.add("down");break;case"ArrowRight":this.input.add("right");break;case"s":this.input.add("s");break;case"Enter":this.input.add("enter")}}),document.addEventListener("keyup",e=>{switch(e.key){case"Escape":this.input.delete("esc");break;case"ArrowUp":this.input.delete("up");break;case"ArrowLeft":this.input.delete("left");break;case"ArrowDown":this.input.delete("down");break;case"ArrowRight":this.input.delete("right");break;case"Enter":this.input.delete("enter");break;case"s":this.input.delete("s")}}),this.start()}start(){}update(e){this.marioSystem.update(e)}clearInput(){this.input.clear()}draw(e){this.marioSystem.draw(e)}};const K=document.querySelector("#gameScreen"),Q=K.getContext("2d");Q.imageSmoothingEnabled=!0,Q.imageSmoothingQuality="high",K.width=800,K.height=600;const V=new r(800,600,Q);let $=0;requestAnimationFrame(function e(t){let s=(t-$)/1e3;$=t,Q.clearRect(0,0,800,600),V.update(s),V.draw(Q),requestAnimationFrame(e)});